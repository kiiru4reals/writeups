### Introduction
Printers are a very fundamental tool for any organization. Network printers have made it possible for users to be able to print documents from their computers if the printer is on the same network.
The Kyocera printer, one of the popular brands in the market has a vulnerability that allows a threat actor to be able to retrieve user details from the address book.
### What is an address book?
An address book is a functionality that is used by printers to store data regarding its users. Information stored may include names, email addresses, fax numbers and, in some cases, passwords among others. This information is stored on the printer's hard disk. The Kyocera address book can be accessed by visiting the web application on the network and selecting address book after logging in. 
### The attack
As earlier stated, a user can export the contents of the address book due to the lack of authentication required by the SOAP API endpoint responsible for managing the address book content. Kyocera exposes its API service on port 9091, which allows users to manage the printer through the SOAP API. This vulnerability occurs when a POST request is sent to the `/ws/km-wsdl/setting/address_book` endpoint. This endpoint can be exploited to retrieve the address book contents without authentication. When an entry is being queried, the printer uses an enumeration number to specify how many addresses to retrieve. By sending a crafted request to this endpoint on port 9091, an attacker can instruct the printer to return sensitive information stored in the address book.
### Impact
Given that users have a high affinity of recycling credentials, compromised credentials can be used to gain initial access to an Active Directory environment, as these credentials are stored as plain text on the printer. An attacker is also able to get access to the printer jobs related to the person whose credentials have been compromised.
### Detecting this vulnerability 
On the site [phrack.me](https://www.phrack.me/exploits/2023/09/25/Porting-CVE-2022-1026-to-Nmap-NSE-Script.html), one can copy the nmap script and save it to the `/usr/share/nmap/scripts` and run an nmap scan as follows
```sh
sudo nmap -A --script=<your_script_name> <target_ip>
```
This will give you a result on whether or not a printer is affected by this issue.
### Exploiting this vulnerability
There is a Proof of Concept done by [ac3lives](https://github.com/ac3lives/kyocera-cve-2022-1026.git) that automates this exploit by sending a request to the address book endpoint on port 9091 to create a new address book object. The script returns an object ID as an integer to retrieve the data. The script then retrieves the data and provides the credentials as output.
### Remediation
I should probably start with the bad news, Kyocera has not released a patch for this particular vulnerability as it is regarded as an issue with [no impact](https://www.kyoceradocumentsolutions.com/en/our-business/security/information/2022-04-04.html) low risk issue (Kyocera's opinion not mine). It is recommended as a rule of thumb to prevent access to this printer from the internet. You are also adviced to enabled the enhanced WSD protocol using SSL to facilitate secure communication between the printer and other hosts in the network. 
The good news is during an engagement, you are able to get possible credentials and get initial access. However, this is a point of concern as these printers will remain to be the weak link as this can be used for threat actors who are doing an insider operation and threat actors who already established initial access to the network through other means such as phishing.